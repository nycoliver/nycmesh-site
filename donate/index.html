<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
  <title>Building the Backbone - NYC Mesh</title>
  <link rel="stylesheet" href="/css/style.css"/>
  <link rel="stylesheet" href="/css/tachyons.min.css"/>
</head>
<body class="sans-serif">
  <header id="top-bar" class="w-100 pv2 ph3 bg-near-white">
    <div class="dt w-100 pv2 mw7 center">
      <div class="dtc v-mid tl w-20">
        <a class="nowrap dib f5 f5 link" title="Home" href="/">
          <p id="logo" class="ttu tracked v-btm f5 fw6 di dark-gray">
            NYC MESH
          </p>
        </a>
      </div>
      <div id="right-buttons" class="dt dtc v-mid w-80 tr f6 fw5">
        <a class="mid-gray dib ph2 pv1 link " title="map" href="/map">
          <p id="logo" class="tracked di">Map</p>
        </a>
        <a class="mid-gray dib ph2 pv1 link" title="FAQ" href="/faq">
          <p id="logo" class="tracked di">FAQ</p>
        </a>
        <a class="mid-gray dib ph2 pv1 link" title="Docs" href="/docs">
          <p id="logo" class="tracked di">Docs</p>
        </a>
        <a class="mid-gray dib ph2 pv1 link" title="Blog" href="/blog">
          <p id="logo" class="tracked di">Blog</p>
        </a>
        <a class="red dib pl2 pv1 link" title="Join" href="/join">
          <p id="logo" class="tracked di">Join</p>
        </a>
      </div>
    </div>
  </header>
  <div id="donate-splash" class="bg-cv">
    <p id="header" class='f2 fw1 ma0 tc pt4 ttu'>Building the Backbone</p>
  </div>

  <!-- Letter -->
  <div class="bg-near-white black-80 tc serif mw6 ph4 pb3 center">
    <p class="f3 mt4 pt3 lh-title">
      NYC Mesh has big plans for 2016!
    </p>
    <p class="f5 lh-copy">
      We're installing a rooftop supernode at 375 Pearl Street, which houses New York's largest data center and has unique lines of sight to a third of the city.
    </p>
    <p class="f5 lh-copy">
      The supernode will allow us to provide a gigabit of bandwidth to much of our existing network. This is a critical step in building a high capacity backbone to support further expansion.
    </p>
    <p class="f5 lh-copy">
      But hardware, bandwidth and rack space cost money.<br>
      All told, we will need around $10,000 to make this a reality.<br>
    </p>
    <p class="f5 lh-copy">
      Please consider making a donation below.
    </p>
    <p class="f5 lh-copy">
      Thanks,<br>
      <a class="b no-underline"href="/team">The Team</a><br>
      NYC Mesh
    </p>
  </div>

  <!-- Stripe Donation -->
  <div id="donation-amounts" class="dt w-100 f3 center bg-near-black white serif">
    <p class="f5 tc pt4 i">
      - Choose a monthly amount -
    </p>
    <div class="mw6 mt2 mb3 tc f2 center">
      <div class="dt center">
        <div class="w1">
        </div>
        <div id="twenty-monthly" onclick="setAmount('twenty-monthly')" class="button dtc mh2 w4 br2 bg-dark-gray">
          <p class="pv0 mv3">$20</p>
        </div>
        <div class="w1">
        </div>
        <div id="fifty-monthly" onclick="setAmount('fifty-monthly')" class="button dtc mh2 w4 br2 bg-dark-gray">
          <p class="pv0 mv3">$50</p>
        </div>
        <div class="w1">
        </div>
        <div id="hundred-monthly" onclick="setAmount('hundred-monthly')" class="button dtc mh2 w4 br2 bg-dark-gray">
          <p class="pv0 mv3">$100</p>
        </div>
        <div class="w1">
        </div>
      </div>
    </div>

    <p class="f5 tc pt4 i">
      - Or make a one time donation -
    </p>
    <div class="mw6 mt2 mb3 tc f2 center">
      <input id="custom" onfocus="setAmount('custom')" type"number" name="donation-amount" placeholder="$" class="tc bg-dark-gray white w4 h3 ph3 br2 bw0">

      <div  class="pt4 mt4 mw5 f4 center">
        <input id="payButton" type="submit" value="Pay with card" class="input-reset bw0 w-100 fw5 br3 pa3 sans-serif white">
        </input>
      </div>
    </div>

    <!-- Donation Details -->
    <div class="gray tc serif pb3 pt2 ph4 mw6 center">
      <p class="f6 lh-copy i">
        All funds will go towards supernode expenses and are sponsored by our fiscal partner, <a class="no-underline light-silver" href="https://isoc-ny.org">ISOC-NY</a>.
      </p>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-near-white mid-gray ph3 ph5-ns pv4 pv5-ns bt b--black-10">
    <div>
      <a class="black-70 link dim b dib mr3" href="map" title="Map">
        Map
      </a>
      <a class="black-70 link dim b dib mr3" href="docs" title="Docs">
        FAQ
      </a>
      <a class="black-70 link dim b dib mr3" href="http://www.meetup.com/nycmesh" title="Components">
        Meetup
      </a>
      <a class="black-70 link dim b dib mr3" href="mailto:contact@nycmesh.net" title="Components">
        Contact
      </a>
      <a class="black-70 link dim b dib mr3 red" href="/join" title="Docs">
        Join
      </a>
    </div>
  </footer>

  <!-- handle form input -->
  <script>
    var donationAmount, donationType, customAmount;
    var customDonation = document.getElementById('custom');
    customDonation.onkeypress = function(e) {
      // not a number
      if (e.which < 48 || e.which > 57)
        e.preventDefault()
    }

    customDonation.addEventListener('input', function(e) {
      var dollars = e.target.value;
      donationAmount = dollars*100;
      customAmount = dollars*100;
    })

    customDonation.addEventListener('focus', function(e) {
      var tmpStr = e.target.value;
      console.log(tmpStr)
      e.target.value = '';
      e.target.value = tmpStr;
      donationAmount = customAmount;
    })

    function setAmount(amount) {
      // deselect selected
      var selected = document.getElementById(donationAmount) || document.getElementById('custom');
      if (selected) {
        if (selected.id == 'custom')
          selected.className = 'tc bg-dark-gray white w4 h3 ph3 br2 bw0'
        else
          selected.className = 'button dtc mh2 w4 br2 bg-dark-gray'
      }

      // highlight choice and set amount
      var button = document.getElementById(amount);
      if (amount == 'custom') {
        console.log(button)
        button.className = 'tc bg-dark-gray white w4 h3 ph3 br2 bw0 selected'
        donationAmount = customAmount;
      }
      else {
        button.className = 'dtc mh2 w4 br2 bg-dark-gray selected';
        donationAmount = amount;
      }
    }
  </script>


  <script src="https://checkout.stripe.com/checkout.js"></script>

  <script>

    function token(token) {
      var request = new XMLHttpRequest();
      request.open('POST', 'https://donate.nycmesh.net/charge', true);
      request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
      request.send(JSON.stringify({
        stripeToken: token,
        donationAmount: donationAmount
      }));
    }

    var stripeConfig = {
      key: 'pk_live_srTdi5OfErTSw5BGXqEkY9C1',
      image: 'https://nycmesh.net:/assets/images/logo.png',
      locale: 'auto',
      zipCode: 'true',
      token: token
    }

    var handler = StripeCheckout.configure(stripeConfig);

    var payButton = document.getElementById('payButton');
    payButton.addEventListener('click', function(e) {

      if (parseInt(donationAmount) && donationAmount > 0) {
        stripeConfig.bitcoin = true;
        handler = StripeCheckout.configure(stripeConfig);
        handler.open({
          name: 'NYC Mesh',
          description: 'Donation',
          amount: donationAmount
        });
      }

      else if (donationAmount == 'twenty-monthly')
        handler.open({
          name: 'NYC Mesh',
          description: 'Monthly Donation',
          amount: 2000
        });

      else if (donationAmount == 'fifty-monthly')
        handler.open({
          name: 'NYC Mesh',
          description: 'Monthly Donation',
          amount: 5000
        });

      else if (donationAmount == 'hundred-monthly')
        handler.open({
          name: 'NYC Mesh',
          description: 'Monthly Donation',
          amount: 10000
        });

      else {
        alert('Please enter a valid donation amount.')
      }

      e.preventDefault();
    });

    // Close Checkout on page navigation:
    window.addEventListener('popstate', function() {
      handler.close();
    });
  </script>
</body>
</html>
